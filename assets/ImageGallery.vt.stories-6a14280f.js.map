{"version":3,"file":"ImageGallery.vt.stories-6a14280f.js","sources":["../../src/image-gallery/transition-helper.ts","../../src/image-gallery/AspectRatio.vt.tsx","../../src/image-gallery/ImageGallery.vt.tsx"],"sourcesContent":["import { flushSync } from \"react-dom\";\n\nexport async function withViewTransition(\n  func: () => void,\n  opts?: { before?: () => void; after?: () => void }\n) {\n  if (document.startViewTransition) {\n    if (opts?.before) {\n      flushSync(opts.before);\n    }\n    const transition = document.startViewTransition(() => {\n      flushSync(func);\n    });\n    await transition.finished;\n    opts?.after?.();\n  } else {\n    func();\n  }\n}\n","import React from \"react\";\nimport styles from \"./AspectRatio.vt.module.css\";\nimport { cn } from \"../utils\";\n\ntype Props = {\n  aspectRatio: number;\n  originalAspectRatio: number;\n  parentClassName?: string;\n  children: React.ReactNode;\n};\nexport function AspectRatio({\n  aspectRatio,\n  children,\n  originalAspectRatio,\n  parentClassName,\n}: Props) {\n  const maxStyle =\n    originalAspectRatio > 1\n      ? {\n          height: \"100%\",\n        }\n      : { width: \"100%\" };\n  return (\n    <div className={cn(styles.main, parentClassName)} style={{ aspectRatio }}>\n      <div\n        className={styles.abs}\n        style={{ aspectRatio: originalAspectRatio, ...maxStyle }}\n      >\n        {children}\n      </div>\n    </div>\n  );\n}\n","import styles from \"./ImageGallery.module.css\";\nimport vtStyles from \"./ImageGallery.vt.module.css\";\nimport { Image } from \"./Image\";\nimport React from \"react\";\nimport { withViewTransition } from \"./transition-helper\";\nimport { AspectRatio } from \"./AspectRatio.vt\";\nimport { styling } from \"./images\";\n\nexport const ImageGallery = () => {\n  const [selectedIndex, setSelectedIndex] = React.useState<null | number>(null);\n  const [isModalVisible, setIsModalVisible] = React.useState(false);\n  const images = React.useMemo(\n    () =>\n      Array(100)\n        .fill(null)\n        .map((_, i) => {\n          return (\n            <AspectRatio\n              aspectRatio={1}\n              originalAspectRatio={styling.width / styling.height}\n              parentClassName={\n                selectedIndex === i && !isModalVisible\n                  ? vtStyles.imageTransition\n                  : undefined\n              }\n            >\n              <Image\n                imageSrc={styling.path}\n                onClick={() =>\n                  withViewTransition(() => setIsModalVisible(true), {\n                    before: () => setSelectedIndex(i),\n                  })\n                }\n                // customClassName={\n                //   selectedIndex === i && !isModalVisible\n                //     ? vtStyles.imageTransition\n                //     : undefined\n                // }\n                style={{ objectFit: \"initial\" }}\n                key={i}\n              />\n            </AspectRatio>\n          );\n        }),\n    [isModalVisible, selectedIndex]\n  );\n  const onClose = React.useCallback(() => {\n    withViewTransition(\n      () => {\n        setIsModalVisible(false);\n      },\n      { after: () => setSelectedIndex(null) }\n    );\n  }, []);\n  return (\n    <div>\n      <div className={styles.galleryGrid}>{images}</div>\n      {isModalVisible && (\n        <div className={vtStyles.modal}>\n          <div className={vtStyles.modalTop}>\n            <button className={styles.closeButton} onClick={onClose}>\n              Close\n            </button>\n          </div>\n          <AspectRatio\n            aspectRatio={styling.width / styling.height}\n            originalAspectRatio={styling.width / styling.height}\n            parentClassName={\n              selectedIndex !== null ? vtStyles.imageTransition : undefined\n            }\n          >\n            <Image\n              imageSrc={styling.path}\n              // customClassName={\n              //   selectedIndex !== null ? vtStyles.imageTransition : undefined\n              // }\n            />\n          </AspectRatio>\n          <div className={vtStyles.modalBottom}>\n            <div className={styles.modalDescription}>\n              <p>Opened {selectedIndex}</p>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n"],"names":["withViewTransition","func","opts","flushSync","_a","AspectRatio","aspectRatio","children","originalAspectRatio","parentClassName","maxStyle","jsx","cn","styles","ImageGallery","selectedIndex","setSelectedIndex","React","isModalVisible","setIsModalVisible","images","_","i","styling","vtStyles","Image","onClose","jsxs"],"mappings":"+eAEsB,eAAAA,EACpBC,EACAC,EACA,OACI,SAAS,qBACPA,GAAA,MAAAA,EAAM,QACRC,YAAUD,EAAK,MAAM,EAKvB,MAHmB,SAAS,oBAAoB,IAAM,CACpDC,EAAA,UAAUF,CAAI,CAAA,CACf,EACgB,UACjBG,EAAAF,GAAA,YAAAA,EAAM,QAAN,MAAAE,EAAA,KAAAF,IAEKD,GAET,2DCRO,SAAAI,EAAA,CAAqB,YAAAC,EAC1B,SAAAC,EACA,oBAAAC,EACA,gBAAAC,CAEF,EAAA,CACE,MAAAC,EAAAF,EAAA,EAAA,CAEM,OAAA,MACU,EAAA,CAAA,MAAA,QAGhB,OAAAG,EAAA,IAAA,MAAA,CAAA,UAAAC,EAAAC,EAAA,KAAAJ,CAAA,EAAA,MAAA,CAAA,YAAAH,CAAA,EAAA,SAAAK,EAAA,IAEI,MAAC,CAAA,UAAAE,EAAA,IACmB,MAAA,CAAA,YAAAL,EAAA,GAAAE,CAAA,EACqC,SAAAH,CAEtD,CAAA,CAAA,CAAA,CAIT,2aCxBO,MAAMO,EAAe,IAAM,CAChC,KAAM,CAACC,EAAeC,CAAgB,EAAIC,EAAM,SAAwB,IAAI,EACtE,CAACC,EAAgBC,CAAiB,EAAIF,EAAM,SAAS,EAAK,EAC1DG,EAASH,EAAM,QACnB,IACE,MAAM,GAAG,EACN,KAAK,IAAI,EACT,IAAI,CAACI,EAAGC,IAELX,EAAA,IAACN,EAAA,CACC,YAAa,EACb,oBAAqBkB,EAAQ,MAAQA,EAAQ,OAC7C,gBACER,IAAkBO,GAAK,CAACJ,EACpBM,EAAS,gBACT,OAGN,SAAAb,EAAA,IAACc,EAAA,CACC,SAAUF,EAAQ,KAClB,QAAS,IACPvB,EAAmB,IAAMmB,EAAkB,EAAI,EAAG,CAChD,OAAQ,IAAMH,EAAiBM,CAAC,CAAA,CACjC,EAOH,MAAO,CAAE,UAAW,SAAU,CAAA,EACzBA,CACP,CAAA,CAAA,CAGL,EACL,CAACJ,EAAgBH,CAAa,CAAA,EAE1BW,EAAUT,EAAM,YAAY,IAAM,CACtCjB,EACE,IAAM,CACJmB,EAAkB,EAAK,CACzB,EACA,CAAE,MAAO,IAAMH,EAAiB,IAAI,CAAE,CAAA,CAE1C,EAAG,CAAE,CAAA,EACL,cACG,MACC,CAAA,SAAA,CAAAL,EAAA,IAAC,MAAI,CAAA,UAAWE,EAAO,YAAc,SAAOO,EAAA,EAC3CF,GACCS,EAAA,KAAC,MAAI,CAAA,UAAWH,EAAS,MACvB,SAAA,CAAAb,EAAA,IAAC,MAAI,CAAA,UAAWa,EAAS,SACvB,SAACb,EAAAA,IAAA,SAAA,CAAO,UAAWE,EAAO,YAAa,QAASa,EAAS,SAAA,OAEzD,CAAA,EACF,EACAf,EAAA,IAACN,EAAA,CACC,YAAakB,EAAQ,MAAQA,EAAQ,OACrC,oBAAqBA,EAAQ,MAAQA,EAAQ,OAC7C,gBACER,IAAkB,KAAOS,EAAS,gBAAkB,OAGtD,SAAAb,EAAA,IAACc,EAAA,CACC,SAAUF,EAAQ,IAAA,CAIpB,CAAA,CACF,EACAZ,EAAA,IAAC,MAAI,CAAA,UAAWa,EAAS,YACvB,SAACb,MAAA,MAAA,CAAI,UAAWE,EAAO,iBACrB,SAAAc,EAAAA,KAAC,IAAE,CAAA,SAAA,CAAA,UAAQZ,CAAA,CAAc,CAAA,CAC3B,CAAA,EACF,CAAA,EACF,CAEJ,CAAA,CAAA,CAEJ"}